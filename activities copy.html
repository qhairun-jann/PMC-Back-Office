<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>App Library | Rizurf Back Office</title>
  <meta name="description" content="A description.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" rel="stylesheet" />
  <link href="assets/css/style.css" rel="stylesheet" />

</head>

<body class="p-0 bg-dark h-100 bg-dark">

  <div class="sticky-top" includeHtml="navbar.html"></div>
  <main class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <section class="mb-5">
      <div class="container mt-5">
        <h1 class="h1 text-white text-center">Activities</h1>
        <hr class="text-white" />
        <div class="filter js-navbar">
          <nav class="menu p-0">
            <ul>
              <li>
                <a class="hasDropdown justify-content-center" href="#">Category</a>
                <section class="filter-container ">

                  <div class="container__list">
                    <input class="form-control " type="text" placeholder="Search" aria-label="Search" />
                    <div class="mt-3 d-flex filterbtn">
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)"> Tour Request </li>
                        <li class="filterClick" onclick="handleFilterClick(event)"> User Registration </li>
                        <li class="filterClick" onclick="handleFilterClick(event)"> Requirements </li>
                        <li class="filterClick" onclick="handleFilterClick(event)"> Appointments </li>
                      </ul>
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">Offers</li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Payments</li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Document Checklist</li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Tenancy Agreements</li>
                      </ul>
                    </div>
                  </div>
                </section>
              </li>
              <li>
                <a href="#" style="padding: 11.5px;"><label class="dateLabel">Select Date</label><input type="date"
                    class="form-control" id="dob" placeholder="Select a Date"></a>
              </li>
              <li>
                <a class="hasDropdown" href="#">Location</a>
                <section class="filter-container has-multi">

                  <div class="container__list container__list-multi">
                    <h5>Building</h5>
                    <input class="form-control" type="text" placeholder="Search" aria-label="Search" />
                    <div class="mt-3 d-flex filterbtn">
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">KL Gateway Residences</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">KL Gateway Premium</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Inwood Residences @ Pantai Sentral
                          Park</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Novum Bangsar South </a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">South View Service Apartments</a>
                        </li>
                      </ul>
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">KL Eco City</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Camellia Serviced Suites</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Secoya Residences</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">The Establishment</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Menara KL Gateway (Work Suites)</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="container__list container__list-multi">
                    <h5>Area</h5>
                    <input class="form-control" type="text" placeholder="Search" aria-label="Search" />
                    <div class="mt-3 d-flex filterbtn">
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">Bangsar</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Bangsar South</a></li>
                      </ul>
                    </div>
                  </div>
                </section>
              </li>
              <li>
                <a class="hasDropdown" href="#">Unit</a>
                <section class="filter-container has-multi">

                  <div class="container__list container__list-multi">
                    <h5>Block</h5>
                    <input class="form-control" type="text" placeholder="Search" aria-label="Search" />
                    <div class="mt-3 d-flex filterbtn">
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block A</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block B</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block C</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block D </a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block E</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block F</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block G</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Block H</a></li>
                      </ul>
                    </div>
                  </div>
                  <div class="container__list container__list-multi">
                    <h5>Level</h5>
                    <input class="form-control" type="text" placeholder="Search" aria-label="Search" />
                    <div class="mt-3 d-flex filterbtn">
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">Basement</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Ground Floor</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 1</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 2</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 3</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 3A</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 5</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 6</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">Level 7</a></li>
                      </ul>
                    </div>
                  </div>
                  <div class="container__list container__list-multi">
                    <h5>Unit no.</h5>
                    <input class="form-control" type="text" placeholder="Search" aria-label="Search" />
                    <div class="mt-3 d-flex filterbtn">
                      <ul>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-1</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-2</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-3</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-3A</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-5</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-6</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-7</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-8</a></li>
                        <li class="filterClick" onclick="handleFilterClick(event)">A-G-9</a></li>
                      </ul>
                    </div>
                  </div>
                </section>
              </li>
              <li>
                <a href="#">Unread *Highly Important</a>
              </li>
            </ul>
          </nav>
        </div>

        <section id="hrFilter" style="display: none;justify-content: center;">
          <hr class="text-white" style="width: 100%;" />
          <div class="btn btn-sm btn-danger m-2" onclick="removeAllFilterBtn()">
            <span>Remove all</span>
          </div>
          <section id="filter-content">
            <!-- <div class="btn btn-sm btn-secondary m-2">Tour Request <span class="close ps-2"
                onclick="HandCloseBtnFilter(event)">x</span> </div>
            <div class="btn btn-sm btn-secondary m-2">KL Eco City <span class="close ps-2"
                onclick="HandCloseBtnFilter(event)">x</span> </div> -->

          </section>
          <hr class="text-white" style="width: 100%;" />

        </section>
    </section>

    <div class="row justify-content-center ">
      <div class="col-sm-10">
        <div class="row justify-content-center">
          <div class="col-sm-12">
            <div class="timeline" id="timeline">
              <!-- <div class="timelinecontainer filterDiv right made cat2 unit2 bldng2 date2"
                    data-name="cat2, unit2, bldng2, date2">
                    <div class="content" onclick="location.href='tourrequest-details.html';">
                      <small class="text-muted">13 Feb 2021 | 1.02 pm</small>
                      <h2>1 New Tour Request </h2>
                      <p>Philly Jackson wants to tour a unit in Lake Side Residence</p>
                    </div>
                  </div>
                  <div class="timelinecontainer filterDiv right cat1 unit1 bldng1 date1"
                    data-name="cat1, unit1, bldng1, date1">
                    <div class="content" onclick="location.href='/appointment-details.html';">
                      <small class="text-muted">13 Feb 2021 | 1.02 pm</small>
                      <h2>1 new appointment for property viewing</h2>
                      <p>New appointment fixed for Rudy to view the property at Paradise Residence</p>
                    </div>
                  </div> -->
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
    </section>
    <div includeHtml="footer.html" class="mt-auto"></div>
  </main>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/includefile.js"></script>
  <script src="assets/js/fakeData.js"></script>
  <!-- <script src="assets/js/main.js"></script> -->
  <script>
    includeHTML();

    var hrFilter = document.getElementById("hrFilter");
    var init = false;
    var arrayKeyName = []
    var duplicationID = []
    var UniqueId = []



    function handleFilterClick(event) {
      showFilterSection(event.target.innerText)
    }

    function handleHrFilter(keyName) {

      //This function is to avoid duplication of filter Button 
      let skip = false
      arrayKeyName.map((name) => {
        if (StringTrimmedLowerCase(name) === StringTrimmedLowerCase(keyName))
          skip = true
      })

      if (!keyName || skip)
        return

      hrFilter.style.display = "flex"
      hrFilter.style.flexWrap = "wrap"
      let filterButton = document.createElement("div")
      filterButton.classList.add("btn", "btn-sm", "btn-secondary", "m-2")
      filterButton.innerHTML = `<span>${keyName}</span> <span class="close ps-2" onclick="handleCloseBtnFilter(event)">x</span>`
      document.getElementById("filter-content").appendChild(filterButton)


    }

    function removeAllFilterBtn() {
      arrayKeyName = []
      duplicationID = []
      UniqueId = []
      document.getElementById("filter-content").innerHTML = ''
      // document.getElementById('timeline').innerHTML = ''
      init = false
      showFilterSection()
      hrFilter.style.display = "none"
      activities.map((sectionData) => {
        CreateNewSection(sectionData)
      })
    }

    function removeItemInArray(key, value) {
      return arrayKeyName.filter(function (ele) {
        return ele != value;
      });
    }

    function removeArray(value) {
      let tempArray = []

      for (let index = 0; index < arrayKeyName.length; index++) {
        // console.log("---->",arrayKeyName[index])
        if (arrayKeyName[index] !== value) {
          console.log('arrayKeyName[index]:', arrayKeyName[index])
          tempArray.push(arrayKeyName[index])

        }
      }

      console.log('tempArray:', tempArray)
      return tempArray
    }


    function StringTrimmed(data) {
      let tempString = String(data)
      return tempString.trim()
    }

    function StringTrimmedLowerCase(data) {
      let tempString = String(data)
      tempString = tempString.trim()
      return tempString.toLowerCase()
    }

    //Code Purpose Below:
    //1. Remove the selected Btn Filter 
    //2. Use the selected Btn Filter  to remove the coressponding Id in duplicationID Array
    //3. update the uniqueId with the new duplicationID
    //4. re render section based on uniqueId
    function handleCloseBtnFilter(event) {
      const text = event.target.parentNode.children[0].innerText
      let TrimText = StringTrimmedLowerCase(text)
      var result = removeItemInArray(arrayKeyName, TrimText);
      // var result = removeArray(StringTrimmed(text));
      arrayKeyName = [...result]
      event.target.parentElement.remove()

      console.log('hrFilter.innerText:', hrFilter.innerText)
      if (hrFilter.innerText === "Remove all") {
        init = false;
        hrFilter.style.display = "none"
        showFilterSection()
        return
      }
      const tempArray = []
      for (let index = 0; index < activities.length; index++) {
        const elementData = activities[index]
        const filterKeyData = elementData.filterKey

        for (let index = 0; index < filterKeyData.length; index++) {
          const data = filterKeyData[index];

          // console.log('data.item:', data.item)
          // console.log('TrimText:', TrimText)
          // console.log('TrimText === data.item:', TrimText === data.item)
          if (TrimText === data.item) {
            tempArray.push(elementData.id)
            break;
          }
        }
      }
      tempArray.map((toRemoveId) => {
        // console.log( 'duplicationID-X :', duplicationID.filter(function (x) { return x !== toRemoveId }) )
        duplicationID = duplicationID.filter(function (x) { return x !== toRemoveId })
      })
      UniqueId = [...new Set(duplicationID)];
      document.getElementById('timeline').innerHTML = ''
      RenderUniqueSections()

    }

    function showFilterSection(keyName) {
      // store id and keyname in arrayKeyName here instead in handlefilterclick
      handleHrFilter(keyName)
      // const keyFilter = keyName
      trimmedKey = StringTrimmed(keyName)
      arrayKeyName = [...arrayKeyName, trimmedKey]

      let stringKeyName = StringTrimmedLowerCase(keyName)
      document.getElementById('timeline').innerHTML = ''

      if (!init) {
        activities.map((sectionData) => {
          init = true
          CreateNewSection(sectionData)
        })
      }
      else if (init) {
        activities.map((sectionData) => {
          handleMultipleFilter(sectionData)
        })
        RenderUniqueSections()

      }
    }

    // purpose code : To display unique Element Only
    // NO DUPLICATION Element show!!!
    function RenderUniqueSections() {
      UniqueId.map((id) => {
        activities.map((sectionData) => {
          if (sectionData.id === id) CreateNewSection(sectionData)
        })

      })
    }


    function handleMultipleFilter(theSectionData) {

      //Purpose of the code below : To store unique html element id in array, respectful to the selected filter key
      let filterKey = theSectionData.filterKey;
      for (let index = 0; index < filterKey.length; index++) {
        const key = filterKey[index].item;

        for (let index = 0; index < arrayKeyName.length; index++) {
          const keyName = arrayKeyName[index];
          const trimmedKey1 = StringTrimmedLowerCase(key) //key from db
          const trimmedKey2 = StringTrimmedLowerCase(keyName) //key store in local


          if (trimmedKey1 === trimmedKey2) {
            //this Code below is to trim the duplicated id and make it unique,
            duplicationID = [...duplicationID, theSectionData.id];
            UniqueId = [...new Set(duplicationID)];
            break;
          }
        }
      }

    }

    function CreateNewSection(theSectionData) {
      const sectionElement = document.createElement("section")
      sectionElement.setAttribute("data-timelineid", theSectionData.id)
      sectionElement.classList.add('timelinecontainer', 'bldng1', 'date1', 'filterDiv', 'right', 'cat1', 'unit1')
      sectionElement.innerHTML = `<div class="content" onclick="location.href='#';">
              ${theSectionData.dateElement}
              ${theSectionData.titleElement}
              ${theSectionData.descriptionElement}
            
              </div>`
      document.getElementById('timeline').appendChild(sectionElement)
    }

    showFilterSection()

  </script>

</body>

</html>